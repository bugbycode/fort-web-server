<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<!--<![endif]-->
<head>
	<meta charset="utf-8" />
	<meta th:include="pages/layout/title :: title"></meta>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	
	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
	<link href="../assets/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../assets/plugins/font-awesome/5.3/css/all.min.css" rel="stylesheet" />
	<link href="../assets/plugins/ionicons/css/ionicons.min.css" rel="stylesheet" />
	<link href="../assets/plugins/animate/animate.min.css" rel="stylesheet" />
	<link href="../assets/css/apple/style.min.css" rel="stylesheet" />
	<link href="../assets/css/apple/style-responsive.min.css" rel="stylesheet" />
	<link href="../assets/css/apple/theme/default.css" rel="stylesheet" id="theme" />
	<!-- ================== END BASE CSS STYLE ================== -->
	
	<!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
	<link href="../assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.css" rel="stylesheet" />
	<link href="../assets/plugins/ionRangeSlider/css/ion.rangeSlider.css" rel="stylesheet" />
	<link href="../assets/plugins/ionRangeSlider/css/ion.rangeSlider.skinNice.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css" rel="stylesheet" />
	<link href="../assets/plugins/password-indicator/css/password-indicator.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-combobox/css/bootstrap-combobox.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css" rel="stylesheet" />
	<link href="../assets/plugins/jquery-tag-it/css/jquery.tagit.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet" />
	<link href="../assets/plugins/select2/dist/css/select2.min.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-eonasdan-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
	<link href="../assets/plugins/bootstrap-colorpalette/css/bootstrap-colorpalette.css" rel="stylesheet" />
	<link href="../assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.css" rel="stylesheet" />
	<link href="../assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker-fontawesome.css" rel="stylesheet" />
	<link href="../assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker-glyphicons.css" rel="stylesheet" />
	<!-- ================== END PAGE LEVEL STYLE ================== -->
	
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="../assets/plugins/pace/pace.min.js"></script>
	<!-- ================== END BASE JS ================== -->
	<style type="text/css">
		.dataTables_filter{
			text-align: right;
		}
		.hand{
			cursor: pointer;
		}
		.cssCheckboxAll{
			margin-top: -24px;
		}
		
		.cssTabCheckBox{
			margin-top: -6px;
		}
		
		.select2-container .select2-selection--single, .select2-container--default .select2-selection--multiple {
		    min-height: 34px!important;
		    border-color: #4CD964!important;
		    outline: 0!important;
		}
		
		.tagit-choice > i {
			margin-top: 7px;
		}
		
		.tdLineHeight{
			line-height: 30px;
		}
		
	</style>
</head>
<body>
	<!-- begin #page-loader -->
	<div id="page-loader" class="fade show"><span class="spinner"></span></div>
	<!-- end #page-loader -->
	
	<!-- begin #page-container -->
	<div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
		<!-- begin #header -->
		<div th:include="pages/layout/head :: head"></div>
		<!-- end #header -->
		
		<!-- 左侧菜单 -->
		<div th:include="pages/layout/left :: left('rule','rule')"></div>
		
		<!-- begin #content -->
		<div id="content" class="content">
			<form id="userForm" method="post" th:object="${r}" th:action="*{id eq 0 ? '/rule/insert' : '/rule/update'}" autocomplete="off">
			<input type="hidden" th:field="*{id}" />
			<input type="hidden" name="userInfo" id="userInfo" />
			<input type="hidden" name="resInfo" id="resInfo" />
			<input type="hidden" name="accInfo" id="accInfo" />
			<!-- begin breadcrumb -->
			<ol class="breadcrumb pull-right">
				<li class="breadcrumb-item"><a href="javascript:;" th:onclick="'location.href=\'/rule/query\';'">授权列表</a></li>
				<li class="breadcrumb-item active" th:text="*{id > 0 ? '编辑授权' : '添加授权'}">添加授权</li>
			</ol>
			<!-- end breadcrumb -->
			<!-- begin page-header -->
			<h1 class="page-header" th:text="*{id > 0 ? '编辑授权' : '添加授权'}">授权信息<small></small></h1>
			<!-- end page-header -->
			<!-- <div class="panel panel-inverse">
				<div class="panel-heading">
					<div class="panel-heading-btn">
						
					</div>
					<h4 class="panel-title"><span class="hand" th:onclick="'location.href=\'/user/query\';'">授权列表</span>&nbsp;/&nbsp;新建授权</h4>
				</div>
			</div> -->
			
			<div class="row">
				<div class="col-lg-12">
					<div>
						<div class="panel panel-inverse">
							<div class="panel-heading">
								<div class="panel-heading-btn">
									<a th:if="*{id eq 0}" href="javascript:showUserModal();" class="btn btn-xs btn-icon btn-circle btn-default" title="添加运维人员"><i class="fa fa-plus"></i></a>
									<a th:if="*{id eq 0}" href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default delUserChecked" title="移除运维人员"><i class="fa fa-trash-alt"></i></a>
								</div>
								<h4 class="panel-title">运维人员</h4>
							</div>
							<div class="panel-body table-responsive">
								<table id="user-data-table-default" class="table table-striped table-bordered dataTable no-footer dtr-inline table-hover">
									<thead>
										<tr>
											<th th:if="*{id eq 0}" width="40px">
												<div class="checkbox checkbox-css cssCheckboxAll hand">
			                                         <input type="checkbox" id="cssTUserCheckboxAll" />
			                                         <label class="hand" for="cssTUserCheckboxAll"></label>
			                                     </div>
											</th>
											<th class="text-nowrap">用户名</th>
											<th class="text-nowrap">姓名</th>
											<th class="text-nowrap">所属角色</th>
											<th class="text-nowrap">所属分组</th>
											<th th:if="*{id eq 0}" class="text-nowrap" width="80px">操作</th>
										</tr>
									</thead>
									<tbody>
										<tr th:if="*{id > 0}" class="odd gradeA">
											<td th:text="*{empUserName}"></td>
											<td th:text="*{empName}"></td>
											<td th:text="*{empRoleName}"></td>
											<td th:text="*{empGroupName}"></td>
										</tr>
										<tr th:if="*{id eq 0}" class="odd gradeA">
											<td colspan="6" style="text-align: center;">请添加运维人员</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="panel panel-inverse">
							<div class="panel-heading">
								<div class="panel-heading-btn">
									<a th:if="*{id eq 0}" href="javascript:showResModal();" class="btn btn-xs btn-icon btn-circle btn-default" title="添加设备"><i class="fa fa-plus"></i></a>
									<a th:if="*{id eq 0}" onclick="removeAllRes(this)" href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default delChecked" title="移除设备"><i class="fa fa-trash-alt"></i></a>
								</div>
								<h4 class="panel-title">设备信息</h4>
							</div>
							<div class="panel-body table-responsive">
								<table id="res-data-table-default" class="table table-striped table-bordered dataTable no-footer dtr-inline table-hover">
									<thead>
										<tr>
											<th th:if="*{id eq 0}" width="2%">
												<div class="checkbox checkbox-css cssCheckboxAll hand">
			                                         <input type="checkbox" id="cssTResCheckboxAll" />
			                                         <label class="hand" for="cssTResCheckboxAll"></label>
			                                     </div>
											</th>
											<th width="10%" class="text-nowrap">基本信息</th>
											<th width="10%" class="text-nowrap">所属网络</th>
											<th width="15%" class="text-nowrap">操作系统</th>
											<th width="30%" class="text-nowrap">授权账号</th>
											<th th:if="*{id eq 0}" class="text-nowrap" width="2%">操作</th>
										</tr>
									</thead>
									<tbody>
										<tr th:if="*{id > 0}" class="odd gradeA">
											<td class="tdLineHeight" style="display: none;">
												<div style="margin-top:0px;" class="checkbox checkbox-css cssTabCheckBox">
													<input type="checkbox" name="resIds" th:id="*{'cssTResCheckbox' + resId}" th:value="*{resId}">
													<label class="hand" th:for="*{'cssTResCheckbox' + resId}">
													</label>
												</div>
											</td>
											<td>
												<span th:text="*{resName}"></span><br/>
												<span th:text="*{'(' + resIp + ')'}"></span>
											</td>
											<td class="tdLineHeight" th:text="*{networkName}">
											</td>
											<td>
												<span th:text="*{resType}"></span><br/>
												<span th:text="*{'(' + resOsType + ')'}"></span>
											</td>
											<td>
												<ul id="jquery-tagIt-inverse" class="inverse tagit ui-widget ui-widget-content ui-corner-all">
													<li th:each="acc:${r.accountList}" class="tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable tagit-account">	
														<span class="tagit-label" th:text="${acc.account}">scott</span>
														<a onclick="removeAcc(this)" class="tagit-close">
															<span class="text-icon">×</span><span class="ui-icon ui-icon-close"></span>
														</a>
													</li>
													<li onclick="showAccountModal(this)" class="tagit-choice addAcc">		
														<i class="fas fa-lg fa-fw fa-plus-circle hand"></i>	
													</li>	
													<li onclick="removeAllAcc(this)" class="tagit-choice delAllAcc">		
														<i class="fas fa-lg fa-fw fa-trash-alt hand"></i>	
													</li>
												</ul>
											</td>
										</tr>
										<tr th:if="*{id eq 0}" class="odd gradeA">
											<td colspan="7" style="text-align: center;">请添加运维设备</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-12">
					<button type="button" class="btn btn-sm btn-primary m-r-5 data-submit">提交</button>
					<button type="button" class="btn btn-sm btn-default m-r-5" th:onclick="'location.href=\'/rule/query\';'">返回</button>
				</div>
			</div>
			</form>
		</div>
		<!-- end #content -->
		<!-- begin scroll to top btn -->
		<a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
		<!-- end scroll to top btn -->
	</div>
	<!-- end page container -->
	
	<!-- #user-modal-dialog -->
	<div class="modal fade" id="user-modal-dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">人员信息</h4>
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				</div>
				<div class="modal-body">
					<div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
						<div class="row">
							<div class="col-sm-12">
								<div class="dataTables_filter">
									<label>
										<input type="text" name="paramQuery" value="" class="form-control input-sm" placeholder="请输入查询条件" aria-controls="data-table-default">
										<i class="ion-ios-search fa-2x fa-fw pull-right m-r-0 text-black-lighter hand"></i>
									</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12 table-responsive">
								<table id="data-table-default" class="table table-striped table-bordered dataTable no-footer dtr-inline table-hover">
									<thead>
										<tr>
											<th width="10px">
												<div class="checkbox checkbox-css cssCheckboxAll hand">
			                                         <input type="checkbox" id="cssUserCheckboxAll" />
			                                         <label class="hand" for="cssUserCheckboxAll"></label>
			                                     </div>
											</th>
											<th class="text-nowrap">用户名</th>
											<th class="text-nowrap">姓名</th>
											<th class="text-nowrap">所属角色</th>
											<th class="text-nowrap">所属分组</th>
										</tr>
									</thead>
									<tbody>
										
									</tbody>
								</table>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12 userPage">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<a href="javascript:;" class="btn btn-white" data-dismiss="modal">关闭</a>
					<a href="javascript:;" class="btn btn-primary">确定</a>
				</div>
			</div>
		</div>
	</div>
	
	<!-- #res-modal-dialog -->
	<div class="modal fade" id="res-modal-dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">设备信息</h4>
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				</div>
				<div class="modal-body">
					<div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
						<div class="row">
							<div class="col-sm-12">
								<div class="dataTables_filter">
									<label>
										<input type="text" name="paramQuery" value="" class="form-control input-sm" placeholder="请输入查询条件" aria-controls="data-table-default">
										<i class="ion-ios-search fa-2x fa-fw pull-right m-r-0 text-black-lighter hand"></i>
									</label>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12 table-responsive">
								<table id="data-table-default" class="table table-striped table-bordered dataTable no-footer dtr-inline table-hover">
									<thead>
										<tr>
											<th width="10px">
												<div class="checkbox checkbox-css cssCheckboxAll hand">
			                                         <input type="checkbox" id="cssResCheckboxAll" />
			                                         <label class="hand" for="cssResCheckboxAll"></label>
			                                     </div>
											</th>
											<th class="text-nowrap">设备名称</th>
											<th class="text-nowrap">访问地址</th>
											<th class="text-nowrap">系统类型</th>
											<th class="text-nowrap">系统版本</th>
											<th class="text-nowrap">所属网络</th>
										</tr>
									</thead>
									<tbody>
										
									</tbody>
								</table>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12 resPage">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<a href="javascript:;" class="btn btn-white" data-dismiss="modal">关闭</a>
					<a href="javascript:;" class="btn btn-primary">确定</a>
				</div>
			</div>
		</div>
	</div>
	
	<!-- #account-modal-dialog -->
	<div class="modal fade" id="account-modal-dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">账号信息</h4>
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				</div>
				<input type="hidden" name="resId" value=""/>
				<div class="modal-body">
					<div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
						<div class="row">
							<div class="col-sm-12 table-responsive">
								<table id="data-table-default" class="table table-striped table-bordered dataTable no-footer dtr-inline table-hover">
									<thead>
										<tr>
											<th colspan="3">
												<div class="checkbox checkbox-css" style="padding-left: 0;display: inline-block;">
			                                         <input type="checkbox" id="cssAccCheckbox" />
			                                         <label class="hand" for="cssAccCheckbox">选择所有</label>
			                                     </div>
											</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>
												<div class="checkbox checkbox-css" style="padding-left: 0;display: inline-block;">
			                                         <input type="checkbox" id="cssAccCheckbox" />
			                                         <label class="hand" for="cssAccCheckbox">scott</label>
			                                     </div>
											</td>
											<td>
												<div class="checkbox checkbox-css" style="padding-left: 0;display: inline-block;">
			                                         <input type="checkbox" id="cssAccCheckbox" />
			                                         <label class="hand" for="cssAccCheckbox">sysdba</label>
			                                     </div>
											</td>
											<td>
												<div class="checkbox checkbox-css" style="padding-left: 0;display: inline-block;">
			                                         <input type="checkbox" id="cssAccCheckbox" />
			                                         <label class="hand" for="cssAccCheckbox">sys</label>
			                                     </div>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12 resPage">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<a href="javascript:;" class="btn btn-white" data-dismiss="modal">关闭</a>
					<a href="javascript:;" class="btn btn-primary">确定</a>
				</div>
			</div>
		</div>
	</div>
	
	<!-- ================== BEGIN BASE JS ================== -->
	<script src="../assets/plugins/jquery/jquery-3.3.1.min.js"></script>
	<script src="../assets/plugins/jquery/jquery-migrate-1.1.0.min.js"></script>
	<script src="../assets/plugins/jquery-ui/jquery-ui.min.js"></script>
	<script src="../assets/plugins/bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
	<!--[if lt IE 9]>
		<script src="../assets/crossbrowserjs/html5shiv.js"></script>
		<script src="../assets/crossbrowserjs/respond.min.js"></script>
		<script src="../assets/crossbrowserjs/excanvas.min.js"></script>
	<![endif]-->
	<script src="../assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="../assets/plugins/js-cookie/js.cookie.js"></script>
	<script src="../assets/js/theme/apple.min.js"></script>
	<script src="../assets/js/apps.min.js"></script>
	<!-- ================== END BASE JS ================== -->
	
	<!-- ================== BEGIN PAGE LEVEL JS ================== -->
	<script src="../assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<script src="../assets/plugins/ionRangeSlider/js/ion-rangeSlider/ion.rangeSlider.min.js"></script>
	<script src="../assets/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
	<script src="../assets/plugins/masked-input/masked-input.min.js"></script>
	<script src="../assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
	<script src="../assets/plugins/password-indicator/js/password-indicator.js"></script>
	<script src="../assets/plugins/bootstrap-combobox/js/bootstrap-combobox.js"></script>
	<script src="../assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
	<script src="../assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>
	<script src="../assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput-typeahead.js"></script>
	<script src="../assets/plugins/jquery-tag-it/js/tag-it.min.js"></script>
	<script src="../assets/plugins/bootstrap-daterangepicker/moment.js"></script>
	<script src="../assets/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
	<script src="../assets/plugins/select2/dist/js/select2.min.js"></script>
	<script src="../assets/plugins/bootstrap-eonasdan-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
	<script src="../assets/plugins/bootstrap-show-password/bootstrap-show-password.js"></script>
	<script src="../assets/plugins/bootstrap-colorpalette/js/bootstrap-colorpalette.js"></script>
	<script src="../assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.js"></script>
	<script src="../assets/plugins/clipboard/clipboard.min.js"></script>
	<!-- ================== END PAGE LEVEL JS ================== -->
	<!-- 模态框  BEGIN-->
	<script src="../assets/plugins/gritter/js/jquery.gritter.js"></script>
	<script src="../assets/plugins/bootstrap-sweetalert/sweetalert.min.js"></script>
	<!-- 模态框  END-->
	<script type="text/javascript" src="../javascript/custom/bugbycode.js"></script>
	<script type="text/javascript" src="../validator/validator.js"></script>
	
	<script>
		App.init();
	</script>
	<script type="text/javascript">
		$(document).ready(function(){
			$(".logout").click(function(){
				$("#logoutForm").submit();
			});
			
			$(".data-submit").click(function(){
				var id = $(this).closest("form").find("#id").val();
				var userInfo = [];
				var resInfo = [];
				var accInfo = [];
				if(id == 0){
					$("#user-data-table-default")
						.find("input[name='empIds']").each(function(index,item){
							userInfo.push($(this).val());
					});
					$("#res-data-table-default")
						.find("input[name='resIds']").each(function(index,item){
							var accounts = [];
							$(this).parent().parent().nextAll().eq(3).find(".tagit-label").each(function(){
								accounts.push($(this).text().trim());
							});
							var obj = {
								resId:$(this).val(),
								accounts:accounts
							};
							resInfo.push(obj);
					});
					if(userInfo.length == 0){
						showMsg("请添加运维人员！");
						return false;
					}
					if(resInfo.length == 0){
						showMsg("请添加设备！");
						return false;
					}
				}else{
					$("#res-data-table-default").find("tbody").find(".tagit-label").each(function(){
						accInfo.push($(this).text().trim());
					});
				}
				$(this).closest("form").find("#userInfo").val(JSON.stringify(userInfo));
				$(this).closest("form").find("#resInfo").val(JSON.stringify(resInfo));
				$(this).closest("form").find("#accInfo").val(JSON.stringify(accInfo));
				$(this).closest("form").submit();
			});
			
			$("#account-modal-dialog").find(".btn-primary").click(function(){
				$("#account-modal-dialog").modal("hide");
				var resId = $("#account-modal-dialog").find("input[name='resId']").val();
				var addObj = $("#cssTResCheckbox" + resId).parent().parent().nextAll().eq(3).find(".addAcc");
				$("#account-modal-dialog").find("tbody").find("td")
					.find("input[type='checkbox']:checked").each(function(index,item){
					//	console.log($(item).parent().find("label").text().trim());
					var accName = $(item).parent().find("label").text().trim();
					if(!checkAccount(addObj,accName)){
						var tableStr = "<li class=\"tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable tagit-account\">";
						tableStr += "	<span class=\"tagit-label\">" + accName + "</span><a onclick=\"removeAcc(this)\" class=\"tagit-close\"><span class=\"text-icon\">×</span><span class=\"ui-icon ui-icon-close\"></span></a>";
						tableStr += "</li>";
						//console.log(accName);
						$(addObj).before(tableStr);
					}
				});
			});
			
			$("#res-modal-dialog").find(".btn-primary").click(function(){
				$("#res-modal-dialog").modal("hide");
				$("#res-modal-dialog").find("div.checkbox").find("input[name='resIds']:checked").each(function(index,item){
					var resId = $(item).val();
					var name = $(item).parent().parent().nextAll().eq(0).text();
					var ip = $(item).parent().parent().nextAll().eq(1).text();
					var type = $(item).parent().parent().nextAll().eq(2).text();
					var osType = $(item).parent().parent().nextAll().eq(3).text();
					var networkName = $(item).parent().parent().nextAll().eq(4).text();
					var tableStr = "<tr class=\"odd gradeA\">";
					tableStr += "<td class=\"tdLineHeight\">";
					tableStr += "<div style=\"margin-top:0px;\" class=\"checkbox checkbox-css cssTabCheckBox\">";
					tableStr += "<input type=\"checkbox\" name=\"resIds\" id=\"cssTResCheckbox" + resId + "\" value=\"" + resId + "\" />";
					tableStr += "<label class=\"hand\" for=\"cssTResCheckbox" + resId + "\"></label>";
					tableStr += "</div>";
					tableStr += "</td>";
					tableStr += "<td>" + name + "<br/>(" + ip + ")</td>";
					tableStr += "<td class=\"tdLineHeight\">" + networkName + "</td>";
					tableStr += "<td>" + type + "<br/>(" + osType + ")</td>";
					tableStr += "<td>";
					tableStr += "<ul id=\"jquery-tagIt-inverse\" class=\"inverse tagit ui-widget ui-widget-content ui-corner-all\">";
					$.ajax({
						url:'/rule/queryAccount',
						type:'get',
						data:'resId=' + resId,
						dataType:'json',
						cache:false,
						async:false,
						success:function(result){
							//console.log(JSON.stringify(result));
							/*for(var i = 0;i < result.length;i++){
								tableStr += "<li class=\"tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable tagit-account\">";
								tableStr += "	<span class=\"tagit-label\">" + result[i].account + "</span><a class=\"tagit-close\"><span class=\"text-icon\">×</span><span class=\"ui-icon ui-icon-close\"></span></a>";
								tableStr += "</li>";
							}
							*/
							$.each(result,function(i,acc){
								tableStr += "<li class=\"tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable tagit-account\">";
								tableStr += "	<span class=\"tagit-label\">" + acc.account + "</span><a onclick=\"removeAcc(this)\" class=\"tagit-close\"><span class=\"text-icon\">×</span><span class=\"ui-icon ui-icon-close\"></span></a>";
								tableStr += "</li>";
							});
						}
					});
					/*
					tableStr += "	<li class=\"tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable tagit-account\">";
					tableStr += "		<span class=\"tagit-label\">sysdba</span><a class=\"tagit-close\"><span class=\"text-icon\">×</span><span class=\"ui-icon ui-icon-close\"></span></a>";
					tableStr += "	</li>";
					tableStr += "	<li class=\"tagit-choice ui-widget-content ui-state-default ui-corner-all tagit-choice-editable tagit-account\">";
					tableStr += "		<span class=\"tagit-label\">scott</span><a class=\"tagit-close\"><span class=\"text-icon\">×</span><span class=\"ui-icon ui-icon-close\"></span></a>";
					tableStr += "	</li>";*/
					tableStr += "	<li onclick=\"showAccountModal(this)\" class=\"tagit-choice addAcc\">";
					tableStr += "		<i class=\"fas fa-lg fa-fw fa-plus-circle hand\"></i>";
					tableStr += "	</li>";
					tableStr += "	<li onclick=\"removeAllAcc(this)\" class=\"tagit-choice delAllAcc\">";
					tableStr += "		<i class=\"fas fa-lg fa-fw fa-trash-alt hand\"></i>";
					tableStr += "	</li>";
					tableStr += "</ul>";
					tableStr += "</td>";
					tableStr += "<td><a href=\"javascript:;\" onclick=\"removeRes(this)\" onmouseover=\"showTip(this)\" title=\"移除设备\" id=\"" + resId + "\" class=\"btn btn-xs btn-icon btn-circle btn-default res-del\"><i class=\"fas fa-lg fa-fw m-r-10 fa-trash-alt\"></i></a></td>";
					tableStr += "</tr>";
					if(!checkResource(resId)){
						$("#res-data-table-default").find("tbody").find("tr:last").before(tableStr);
					}
				});
				if($("#res-data-table-default").find("tbody").find("tr").length > 1){
					$("#res-data-table-default").find("tbody").find("tr:last").hide();
				}
				$("#cssTResCheckboxAll").prop("checked",false);
			});
			
			$("#user-modal-dialog").find(".btn-primary").click(function(){
				$("#user-modal-dialog").find("div.checkbox").find("input:checked").each(function(index,item){
					var empId = $(item).val();
					var empUserName = $(item).parent().parent().nextAll().eq(0).text();
					var empName = $(item).parent().parent().nextAll().eq(1).text();
					var empRoleName = $(item).parent().parent().nextAll().eq(2).text();
					var empGroupName = $(item).parent().parent().nextAll().eq(3).text();
					var tableStr = "<tr class=\"odd gradeA\">";
					tableStr += "<td>";
					tableStr += "<div class=\"checkbox checkbox-css cssTabCheckBox\">";
					tableStr += "<input type=\"checkbox\" name=\"empIds\" id=\"cssTUserCheckbox" + empId + "\" value=\"" + empId + "\" />";
					tableStr += "<label class=\"hand\" for=\"cssTUserCheckbox" + empId + "\"></label>";
					tableStr += "</div>";
					tableStr += "</td>";
					tableStr += "<td>" + empUserName + "</td>";
					tableStr += "<td>" + empName + "</td>";
					tableStr += "<td>" + empRoleName + "</td>";
					tableStr += "<td>" + empGroupName + "</td>";
					tableStr += "<td><a href=\"javascript:;\" onmouseover=\"showTip(this)\" title=\"移除用户\" id=\"" + empId + "\" class=\"btn btn-xs btn-icon btn-circle btn-default user-del\"><i class=\"fas fa-lg fa-fw m-r-10 fa-trash-alt\"></i></a></td>";
					tableStr += "</tr>";
					if(!checkUser(empId)){
						$("#user-data-table-default").find("tbody").find("tr:last").before(tableStr);
					}
				});
				if($("#user-data-table-default").find("tbody").find("tr").length > 1){
					$("#user-data-table-default").find("tbody").find("tr:last").hide();
				}
				$("#user-modal-dialog").modal("hide");
			});
			
			$("#user-modal-dialog").find("input[name='paramQuery']").keypress(function(event){
				if(event.keyCode == 13){
					queryUser(0,$(this).val());
				}
			});
			
			$("#user-modal-dialog").find(".ion-ios-search").click(function(){
				queryUser(0,$("#user-modal-dialog").find("input[name='paramQuery']").val());
			});
			
			$("#res-modal-dialog").find("input[name='paramQuery']").keypress(function(event){
				if(event.keyCode == 13){
					queryResource(0,$(this).val());
				}
			});
			
			$("#res-modal-dialog").find(".ion-ios-search").click(function(){
				queryResource(0,$("#res-modal-dialog").find("input[name='paramQuery']").val());
			});
			
			$("#cssUserCheckboxAll").click(function(){
				if($(this).prop("checked")){
					$("#user-modal-dialog").find("div.checkbox").find("input").prop("checked",true);
				}else{
					$("#user-modal-dialog").find("div.checkbox").find("input").prop("checked",false);
				}
			});
			
			$("#cssResCheckboxAll").click(function(){
				if($(this).prop("checked")){
					$("#res-modal-dialog").find("div.checkbox").find("input").prop("checked",true);
				}else{
					$("#res-modal-dialog").find("div.checkbox").find("input").prop("checked",false);
				}
			});
			
			$("#cssTUserCheckboxAll").click(function(){
				if($(this).prop("checked")){
					$("#user-data-table-default").find("div.checkbox").find("input").prop("checked",true);
				}else{
					$("#user-data-table-default").find("div.checkbox").find("input").prop("checked",false);
				}
			});
			
			$("#cssTResCheckboxAll").click(function(){
				if($(this).prop("checked")){
					$("#res-data-table-default").find("div.checkbox").find("input").prop("checked",true);
				}else{
					$("#res-data-table-default").find("div.checkbox").find("input").prop("checked",false);
				}
			});
			
			$("#cssAccCheckbox").click(function(){
				if($(this).prop("checked")){
					$("#account-modal-dialog").find("div.checkbox").find("input").prop("checked",true);
				}else{
					$("#account-modal-dialog").find("div.checkbox").find("input").prop("checked",false);
				}
			});
			
		});
		
		$(document).on('click','.user-del',function(e){
			e.preventDefault();
			var obj = this;
			swal({
				title: '您确定移除除所选的人员吗？',
				text: '您执行该操作后这些人员会从列表中移除，是否继续？',
				icon: 'warning',
				buttons: {
					cancel: {
						text: '取消',
						value: false,
						visible: true,
						className: 'btn btn-default',
						closeModal: true,
					},
					confirm: {
						text: '确定',
						value: true,
						visible: true,
						className: 'btn btn-warning',
						closeModal: true
					}
				}
			}).then(function(value){
				if(value == true){
					$(obj).parent().parent().remove();
					if($("#user-data-table-default").find("tbody").find("tr").length == 1){
						$("#user-data-table-default").find("tbody").find("tr:last").show();
					}
				}
			});
		});
		
		$(".delUserChecked").click(function(e){
			if($("#user-data-table-default").find("input[name='empIds']:checked").length == 0){
				e.preventDefault();
				swal({
					title: '请选择要移除的人员！',
					text: '',
					icon: 'warning',
					buttons: {
						confirm: {
							text: '确定',
							value: true,
							visible: true,
							className: 'btn btn-warning',
							closeModal: true
						}
					}
				})
			}else{
				
				e.preventDefault();
				swal({
					title: '您确定移除除所选的人员吗？',
					text: '您执行该操作后这些人员会从列表中移除，是否继续？',
					icon: 'warning',
					buttons: {
						cancel: {
							text: '取消',
							value: false,
							visible: true,
							className: 'btn btn-default',
							closeModal: true,
						},
						confirm: {
							text: '确定',
							value: true,
							visible: true,
							className: 'btn btn-warning',
							closeModal: true
						}
					}
				}).then(function(value){
					if(value == true){
						$("#user-data-table-default").find("input[name='empIds']:checked").each(function(){
							$(this).parent().parent().parent().remove();
						});
						if($("#user-data-table-default").find("tbody").find("tr").length == 1){
							$("#user-data-table-default").find("tbody").find("tr:last").show();
						}
						$("#cssTUserCheckboxAll").prop("checked",false);
					}
				});
			}
		});
		
		function checkResource(resId){
	    	var flag = false;
	    	var arr = $("#res-data-table-default").find("input[name='resIds']");
	    	for(var index = 0;index < arr.length;index++){
	    		if(arr[index].value == resId){
	    			flag = true;
	    			break;
	    		}
	    	}
	    	return flag;
	    }
		
		function checkUser(empId){
	    	var flag = false;
	    	var arr = $("#user-data-table-default").find("input[name='empIds']");
	    	for(var index = 0;index < arr.length;index++){
	    		if(arr[index].value == empId){
	    			flag = true;
	    			break;
	    		}
	    	}
	    	return flag;
	    }
		
		function changeUserRecord(num){
			queryUser(num,$("#user-modal-dialog").find("input[name='paramQuery']").val());
		}
		
	    function gopage(lastnum){
	    	var page = $("#user-modal-dialog").find("#page").val();
	    	var num = parseInt(page * 10) - parseInt(10);
	    	if (num > lastnum) {
	    		num = lastnum;
	 		}
	    	if(num < 0){
	    		num = 0;
	    	}
	    	queryUser(num,$("#user-modal-dialog").find("input[name='paramQuery']").val());
	    }
	    
	    function changeResRecord(num){
	    	queryResource(num,$("#res-modal-dialog").find("input[name='paramQuery']").val());
		}
		
	    function goRespage(lastnum){
	    	var page = $("#res-modal-dialog").find("#page").val();
	    	var num = parseInt(page * 10) - parseInt(10);
	    	if (num > lastnum) {
	    		num = lastnum;
	 		}
	    	if(num < 0){
	    		num = 0;
	    	}
	    	queryResource(num,$("#res-modal-dialog").find("input[name='paramQuery']").val());
	    }
	    
		function queryUser(startIndex,keyword){
			$.ajax({
				url:"/rule/queryUser",
				type:"get",
				data:"paramQuery=" + keyword + "&startIndex=" + startIndex,
				dataType:"json",
				cache:false,
				success:function(result){
					$("#cssUserCheckboxAll").prop("checked",false);
					var tableStr = "";
					$.each(result.list,function(index,item){
						tableStr += "<tr class=\"gradeA odd\"><td><div class=\"checkbox checkbox-css cssTabCheckBox\">";
						tableStr += "<input type=\"checkbox\" name=\"empIds\" " + (checkUser(item.id) ? "checked" : "")  + " id=\"cssUserCheckbox" + item.id + "\" value=\"" + item.id + "\" />";
						tableStr += "<label class=\"hand\" for=\"cssUserCheckbox" + item.id + "\"></label></div></td>";
						tableStr += "<td>" + item.username + "</td>";
						tableStr += "<td>" + item.name + "</td>";
						tableStr += "<td>" + (item.roleName == null ? "" : item.roleName) + "</td>";
						tableStr += "<td>" + (item.groupName == null ? "" : item.groupName) + "</td>";
						tableStr += "</tr>";
					});
					if(tableStr == ""){
						tableStr += "<tr><td class=\"gradeA odd\" colspan=\"5\" style=\"text-align: center;\">没有查询到匹配的信息</td></tr>";
					}
					$("#user-modal-dialog").find("#data-table-default").find("tbody").html(tableStr);
					var page = result.page;
					var tablePage = "<div class=\"row\"><div class=\"col-sm-5\">";
					tablePage += "<div class=\"dataTables_info\" id=\"data-table-default_info\" role=\"status\" aria-live=\"polite\">";
					tablePage += "共计 " + page.totalCount + " 条记录，当前第" + page.currentPage + "/" + page.pageCount + " 页";
					tablePage += "</div></div>";
					tablePage += "<div class=\"col-sm-7\">";
					tablePage += "<ul class=\"pagination\">";
					if(page.startIndex == 0){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else{
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeUserRecord(\'0\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					if(page.startIndex == 0){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else{
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeUserRecord(\'" + page.previousIndex + "\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					
					if(page.nextIndex == page.startIndex){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else{
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeUserRecord(\'" + page.nextIndex + "\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					
					if(page.lastIndex == page.startIndex){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else if(page.lastIndex == page.startIndex || page.lastIndex > page.startIndex){
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeUserRecord(\'" + page.lastIndex + "\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					
					tablePage += "<li class=\"page-item\">";
					tablePage += "<input id=\"page\" class=\"form-control pageText\" style=\"height: 30px;margin: 1px 0px 0px 4px;width: 60px;\" value=\"" + page.currentPage + "\" />";
					tablePage += "</li>";
					tablePage += "<li class=\"page-item\">";
					tablePage += "<input type=\"hidden\" name=\"startIndex\" id=\"startIndex\" value=\"0\">";
					tablePage += "<input type=\"hidden\" name=\"lastIndex\" id=\"lastIndex\" value=\"" + page.lastIndex + "\">";
					tablePage += "<a href=\"javascript:;\" onclick=\"gopage(\'" + page.lastIndex + "\')\" class=\"page-link\">";
					tablePage += "<i class=\"fas fa-search\"></i>";
					tablePage += "</a>";
					tablePage += "</li>";
					tablePage += "</ul>";
					tablePage += "</div>";
					$("#user-modal-dialog").find(".userPage").html(tablePage);
					//alert($("#user-modal-dialog").find(".userPage").html());
				}
			});
		}
		
		function showUserModal(){
			$("#user-modal-dialog").modal("show");
			queryUser(0,'');
		}
		
		function queryResource(startIndex,keyword){
			$.ajax({
				url:"/rule/queryResource",
				type:"get",
				data:"paramQuery=" + keyword + "&startIndex=" + startIndex,
				dataType:"json",
				cache:false,
				success:function(result){
					$("#cssResCheckboxAll").prop("checked",false);
					var tableStr = "";
					$.each(result.list,function(index,item){
						tableStr += "<tr class=\"gradeA odd\"><td><div class=\"checkbox checkbox-css cssTabCheckBox\">";
						tableStr += "<input type=\"checkbox\" " + (checkResource(item.id) ? "checked=\"checked\"" : "") + " name=\"resIds\" " + (checkResource(item.id) ? "checked" : "")  + " id=\"cssResCheckbox" + item.id + "\" value=\"" + item.id + "\" />";
						tableStr += "<label class=\"hand\" for=\"cssResCheckbox" + item.id + "\"></label></div></td>";
						tableStr += "<td>" + item.name + "</td>";
						tableStr += "<td>" + item.ip + "</td>";
						tableStr += "<td>" + (item.type == null ? "" : item.type) + "</td>";
						tableStr += "<td>" + (item.osType == null ? "" : item.osType) + "</td>";
						tableStr += "<td>" + (item.networkName == null ? "" : item.networkName) + "</td>";
						tableStr += "</tr>";
					});
					if(tableStr == ""){
						tableStr += "<tr><td class=\"gradeA odd\" colspan=\"6\" style=\"text-align: center;\">没有查询到匹配的信息</td></tr>";
					}
					$("#res-modal-dialog").find("#data-table-default").find("tbody").html(tableStr);
					var page = result.page;
					var tablePage = "<div class=\"row\"><div class=\"col-sm-5\">";
					tablePage += "<div class=\"dataTables_info\" id=\"data-table-default_info\" role=\"status\" aria-live=\"polite\">";
					tablePage += "共计 " + page.totalCount + " 条记录，当前第" + page.currentPage + "/" + page.pageCount + " 页";
					tablePage += "</div></div>";
					tablePage += "<div class=\"col-sm-7\">";
					tablePage += "<ul class=\"pagination\">";
					if(page.startIndex == 0){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else{
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeResRecord(\'0\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					if(page.startIndex == 0){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else{
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeResRecord(\'" + page.previousIndex + "\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-left\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					
					if(page.nextIndex == page.startIndex){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else{
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeResRecord(\'" + page.nextIndex + "\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					
					if(page.lastIndex == page.startIndex){
						tablePage += "<li class=\"page-item disabled\">";
						tablePage += "<a href=\"javascript:;\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}else if(page.lastIndex == page.startIndex || page.lastIndex > page.startIndex){
						tablePage += "<li class=\"page-item\">";
						tablePage += "<a href=\"javascript:;\" onclick=\"changeResRecord(\'" + page.lastIndex + "\')\" class=\"page-link\">";
						tablePage += "<i class=\"fas fa-angle-double-right\"></i>";
						tablePage += "</a>";
						tablePage += "</li>";
					}
					
					tablePage += "<li class=\"page-item\">";
					tablePage += "<input id=\"page\" class=\"form-control pageText\" style=\"height: 30px;margin: 1px 0px 0px 4px;width: 60px;\" value=\"" + page.currentPage + "\" />";
					tablePage += "</li>";
					tablePage += "<li class=\"page-item\">";
					tablePage += "<input type=\"hidden\" name=\"startIndex\" id=\"startIndex\" value=\"0\">";
					tablePage += "<input type=\"hidden\" name=\"lastIndex\" id=\"lastIndex\" value=\"" + page.lastIndex + "\">";
					tablePage += "<a href=\"javascript:;\" onclick=\"goRespage(\'" + page.lastIndex + "\')\" class=\"page-link\">";
					tablePage += "<i class=\"fas fa-search\"></i>";
					tablePage += "</a>";
					tablePage += "</li>";
					tablePage += "</ul>";
					tablePage += "</div>";
					$("#res-modal-dialog").find(".resPage").html(tablePage);
					//alert($("#user-modal-dialog").find(".userPage").html());
				}
			});
		}
		
		//
		function showResModal(){
			$("#res-modal-dialog").modal("show");
			queryResource(0,'');
		}
		
		function showTip(obj){
			var title = $(obj).prop('title');
			if (title != undefined) {
				$(obj).tooltip({
					title: title,
					placement: 'top',
					trigger: 'hover',
					container: 'body'
				});
				$(obj).tooltip('show');
				$(obj).attr('data-init', true);
			}
		}
		
		function removeAcc(obj){
			window.event.preventDefault();
			swal({
				title: '您确定移除所选的账号吗？',
				text: '您执行该操作后账号会从栏目中移除，是否继续？',
				icon: 'warning',
				buttons: {
					cancel: {
						text: '取消',
						value: false,
						visible: true,
						className: 'btn btn-default',
						closeModal: true,
					},
					confirm: {
						text: '确定',
						value: true,
						visible: true,
						className: 'btn btn-warning',
						closeModal: true
					}
				}
			}).then(function(value){
				if(value == true){
					$(obj).parent().remove();
				}
			});
		}
		
		function removeAllAcc(obj){
			window.event.preventDefault();
			swal({
				title: '您确定移除所有的账号吗？',
				text: '您执行该操作后所有账号会从栏目中移除，是否继续？',
				icon: 'warning',
				buttons: {
					cancel: {
						text: '取消',
						value: false,
						visible: true,
						className: 'btn btn-default',
						closeModal: true,
					},
					confirm: {
						text: '确定',
						value: true,
						visible: true,
						className: 'btn btn-warning',
						closeModal: true
					}
				}
			}).then(function(value){
				if(value == true){
					$(obj).prev().prevAll().remove();
				}
			});
		}
		
		function removeRes(obj){
			window.event.preventDefault();
			swal({
				title: '您确定移除所选的设备吗？',
				text: '您执行该操作后设备会从列表中移除，是否继续？',
				icon: 'warning',
				buttons: {
					cancel: {
						text: '取消',
						value: false,
						visible: true,
						className: 'btn btn-default',
						closeModal: true,
					},
					confirm: {
						text: '确定',
						value: true,
						visible: true,
						className: 'btn btn-warning',
						closeModal: true
					}
				}
			}).then(function(value){
				if(value == true){
					$(obj).parent().parent().remove();
					if($("#res-data-table-default").find("tbody").find("tr").length == 1){
						$("#res-data-table-default").find("tbody").find("tr:last").show();
					}
					$("#cssTResCheckboxAll").prop("checked",false);
				}
			});
		}
		
		function removeAllRes(obj){
			window.event.preventDefault();
			if($("#res-data-table-default").find("tbody").find("input[name='resIds']:checked").length == 0){
				swal({
					title: '请选择要移除的设备！',
					text: '',
					icon: 'warning',
					buttons: {
						confirm: {
							text: '确定',
							value: true,
							visible: true,
							className: 'btn btn-warning',
							closeModal: true
						}
					}
				})
			}else{
				swal({
					title: '您确定移除所选的设备吗？',
					text: '您执行该操作后设备会从列表中移除，是否继续？',
					icon: 'warning',
					buttons: {
						cancel: {
							text: '取消',
							value: false,
							visible: true,
							className: 'btn btn-default',
							closeModal: true,
						},
						confirm: {
							text: '确定',
							value: true,
							visible: true,
							className: 'btn btn-warning',
							closeModal: true
						}
					}
				}).then(function(value){
					if(value == true){
						$("#res-data-table-default").find("tbody").find("input[name='resIds']:checked").each(function(index,item){
							$(item).parent().parent().parent().remove();
						});
						if($("#res-data-table-default").find("tbody").find("tr").length == 1){
							$("#res-data-table-default").find("tbody").find("tr:last").show();
						}
						$("#cssTResCheckboxAll").prop("checked",false);
					}
				});
			}
		}
		
		function checkAccount(obj,account){
			var accounts = $(obj).prevAll();
			var flag = false;
			for(var index = 0;index < accounts.length;index++){
				//console.log($(accounts[index]).find(".tagit-label").text().trim());
				if(account == $(accounts[index]).find(".tagit-label").text().trim()){
					flag = true;
					break;
				}
			}
			return flag;
		}
		
		function showAccountModal(obj){
			var resId = $(obj).parent().parent().prevAll().last().find("input[name='resIds']").val();
			$("#account-modal-dialog").find("input[name='resId']").val(resId);
			$("#account-modal-dialog").modal("show");
			$.ajax({
				url:'/rule/queryAccount',
				type:'get',
				data:'resId=' + resId,
				dataType:'json',
				cache:false,
				success:function(result){
					var tableStr = "<tr>";
					$.each(result,function(index,item){
						if(index % 3 == 0){
							tableStr += "</tr><tr>";
						}
						tableStr += "<td><div class=\"checkbox checkbox-css\" style=\"padding-left: 0;display: inline-block;\">";
						tableStr += "<input type=\"checkbox\" " + (checkAccount(obj,item.account) ? "checked=\"checked\"" : "") + " id=\"cssAccCheckbox_" + item.account + "\" />";
						tableStr += "<label class=\"hand\" for=\"cssAccCheckbox_" + item.account + "\">" + item.account + "</label>";
						tableStr += "</div></td>";
					});
					var total = result.length;
					if(total > 3){
						var append_num = 3 - total % 3;
						while(append_num > 0){
							tableStr += "<td></td>";
							append_num--;
						}
					}
					if(total == 0){
						tableStr += "<td colspan=\"3\" style=\"text-align: center;\">没有查询到任何账号信息</td>";
					}
					tableStr += "</tr>";
					$("#account-modal-dialog").find("tbody").html(tableStr);
					if(total > 0 && $("#account-modal-dialog").find("tbody").find("input:checked").length == total){
						$("#account-modal-dialog").find("thead").find("input").prop("checked",true);
					}else{
						$("#account-modal-dialog").find("thead").find("input").prop("checked",false);
					}
				}
			});
		}
		
	</script>
</body>
</html>